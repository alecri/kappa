library(metafor)
library(tidyverse)
library(dosresmeta)
library(rms)
library(hetmeta)
options(show.signif.stars = FALSE)
dat <- get(data(coffee_mort))
k <- quantile(dat$dose, c(.1, .5, .9))
spl <- dosresmeta(logrr ~ rcs(dose, k), id = id, se = se, type = type,
cases = cases, n = n, data = dat, proc = "1stage")
xref <- 0
newd <- data.frame(dose = c(xref, seq(0, 8, length.out = 100)))
spl
library("dplyr")
#install.packages("audio")
library("audio")
notes <- c(A = 0, B = 2, C = 3, D = 5, E = 7, F = 8, G = 10)
pitch <- "D D E D G F# D D E D A G D D D5 B G F# E C5 C5 B G A G"
duration <- c(rep(c(0.75, 0.25, 1, 1, 1, 2), 2),
0.75, 0.25, 1, 1, 1, 1, 1, 0.75, 0.25, 1, 1, 1, 2)
bday <- data_frame(pitch = strsplit(pitch, " ")[[1]],
duration = duration)
bday <-
bday %>%
mutate(octave = substring(pitch, nchar(pitch)) %>%
{suppressWarnings(as.numeric(.))} %>%
ifelse(is.na(.), 4, .),
note = notes[substr(pitch, 1, 1)],
note = note + grepl("#", pitch) -
grepl("b", pitch) + octave * 12 +
12 * (note < 3),
freq = 2 ^ ((note - 60) / 12) * 440)
tempo <- 120
sample_rate <- 44100
make_sine <- function(freq, duration) {
wave <- sin(seq(0, duration / tempo * 60, 1 / sample_rate) *
freq * 2 * pi)
fade <- seq(0, 1, 50 / sample_rate)
wave * c(fade, rep(1, length(wave) - 2 * length(fade)), rev(fade))
}
bday_wave <-
mapply(make_sine, bday$freq, bday$duration) %>%
do.call("c", .)
play(bday_wave)
play(bday_wave)
newd %>%
cbind(
predict(spl, ., expo = T)
)
newd %>%
cbind(
predict(spl, ., expo = T)
) %>%
ggplot(aes(dose, pred)) +
geom_line()
newd %>%
cbind(
predict(spl, ., expo = T)
) %>%
ggplot(aes(dose, pred)) +
geom_line() +
geom_ribbon(aes(ci.lb, ci.ub)) +
scale_y_continuous(trans = "log", breaks = c(.8, .85, .9, .95, 1)) +
labs(x = "Exposure", y = "Relative Risk")
newd %>%
cbind(
predict(spl, ., expo = T)
) %>%
ggplot(aes(dose, pred)) +
geom_line() +
geom_ribbon(aes(ymin = ci.lb, ymax = ci.ub)) +
scale_y_continuous(trans = "log", breaks = c(.8, .85, .9, .95, 1)) +
labs(x = "Exposure", y = "Relative Risk")
newd %>%
cbind(
predict(spl, ., expo = T)
) %>%
ggplot(aes(dose, pred)) +
geom_line() +
geom_ribbon(aes(ymin = ci.lb, ymax = ci.ub), alpha = .2) +
scale_y_continuous(trans = "log", breaks = c(.8, .85, .9, .95, 1)) +
labs(x = "Exposure", y = "Relative Risk")
newd %>%
cbind(
predict(spl, ., expo = T)
) %>%
ggplot(aes(dose, pred)) +
geom_line() +
geom_ribbon(aes(ymin = ci.lb, ymax = ci.ub), alpha = .2) +
scale_y_continuous(trans = "log", breaks = c(.8, .85, .9, .95, 1)) +
labs(x = "Exposure", y = "Relative Risk") +
theme_classic()
data.frame(dose = c(1, seq(0, 8, length.out = 100))) %>%
cbind(
predict(spl, ., expo = T)
) %>%
ggplot(aes(dose, pred)) +
geom_line() +
geom_ribbon(aes(ymin = ci.lb, ymax = ci.ub), alpha = .2) +
scale_y_continuous(trans = "log", breaks = c(.8, .85, .9, .95, 1)) +
labs(x = "Exposure", y = "Relative Risk") +
theme_classic()
data.frame(dose = c(1, seq(0, 8, length.out = 100))) %>%
cbind(
predict(spl, ., expo = T)
) %>%
ggplot(aes(dose, pred)) +
geom_line() +
geom_ribbon(aes(ymin = ci.lb, ymax = ci.ub), alpha = .2) +
scale_y_continuous(trans = "log", breaks = c(.8, .85, .9, .95, 1, 1.1, 1.2)) +
labs(x = "Exposure", y = "Relative Risk") +
theme_classic()
data.frame(dose = c(1, seq(0, 8, length.out = 100))) %>%
cbind(
predict(spl, ., expo = T)
) %>%
ggplot(aes(dose, pred)) +
geom_line() +
geom_ribbon(aes(ymin = ci.lb, ymax = ci.ub), alpha = .2) +
scale_y_continuous(trans = "log", breaks = c(.8, .85, .9, .95, 1, 1.05, 1.1)) +
labs(x = "Exposure", y = "Relative Risk") +
theme_classic()
?geom_segment
data.frame(dose = c(1, seq(0, 8, length.out = 100))) %>%
cbind(
predict(spl, ., expo = T)
) %>%
ggplot(aes(dose, pred)) +
geom_line() +
geom_segment(x = 1, y = 0.1, xend = 1, yend = 1) +
geom_ribbon(aes(ymin = ci.lb, ymax = ci.ub), alpha = .2) +
scale_y_continuous(trans = "log", breaks = c(.8, .85, .9, .95, 1, 1.05, 1.1)) +
labs(x = "Exposure", y = "Relative Risk") +
theme_classic()
data.frame(dose = c(1, seq(0, 8, length.out = 100))) %>%
cbind(
predict(spl, ., expo = T)
) %>%
ggplot(aes(dose, pred)) +
geom_line() +
geom_segment(x = 1, y = 0.1, xend = 1, yend = 0) +
geom_ribbon(aes(ymin = ci.lb, ymax = ci.ub), alpha = .2) +
scale_y_continuous(trans = "log", breaks = c(.8, .85, .9, .95, 1, 1.05, 1.1)) +
labs(x = "Exposure", y = "Relative Risk") +
theme_classic()
data.frame(dose = c(1, seq(0, 8, length.out = 100))) %>%
cbind(
predict(spl, ., expo = T)
) %>%
ggplot(aes(dose, pred)) +
geom_line() +
geom_segment(x = 1, y = 0.1, xend = 1, yend = 0, linetype = "dashed") +
geom_ribbon(aes(ymin = ci.lb, ymax = ci.ub), alpha = .2) +
scale_y_continuous(trans = "log", breaks = c(.8, .85, .9, .95, 1, 1.05, 1.1)) +
labs(x = "Exposure", y = "Relative Risk") +
theme_classic()
data.frame(dose = c(1, seq(0, 8, length.out = 100))) %>%
cbind(
predict(spl, ., expo = T)
) %>%
ggplot(aes(dose, pred)) +
geom_line() +
geom_segment(x = 1, y = 0.9, xend = 1, yend = 0, linetype = "dashed") +
geom_ribbon(aes(ymin = ci.lb, ymax = ci.ub), alpha = .2) +
scale_y_continuous(trans = "log", breaks = c(.8, .85, .9, .95, 1, 1.05, 1.1)) +
labs(x = "Exposure", y = "Relative Risk") +
theme_classic()
data.frame(dose = c(1, seq(0, 8, length.out = 100))) %>%
cbind(
predict(spl, ., expo = T)
) %>%
ggplot(aes(dose, pred)) +
geom_line() +
geom_segment(x = 1, y = -0.9, xend = 1, yend = 0, linetype = "dashed") +
geom_ribbon(aes(ymin = ci.lb, ymax = ci.ub), alpha = .2) +
scale_y_continuous(trans = "log", breaks = c(.8, .85, .9, .95, 1, 1.05, 1.1)) +
labs(x = "Exposure", y = "Relative Risk") +
theme_classic()
data.frame(dose = c(1, seq(0, 8, length.out = 100))) %>%
cbind(
predict(spl, ., expo = T)
) %>%
ggplot(aes(dose, pred)) +
geom_line() +
geom_segment(x = 1, y = -1, xend = 1, yend = 0, linetype = "dashed") +
geom_ribbon(aes(ymin = ci.lb, ymax = ci.ub), alpha = .2) +
scale_y_continuous(trans = "log", breaks = c(.8, .85, .9, .95, 1, 1.05, 1.1)) +
labs(x = "Exposure", y = "Relative Risk") +
theme_classic()
data.frame(dose = c(1, seq(0, 8, length.out = 100))) %>%
cbind(
predict(spl, ., expo = T)
) %>%
ggplot(aes(dose, pred)) +
geom_line() +
geom_segment(x = 1, y = -1, xend = 1, yend = 0, linetype = "dashed") +
geom_segment(x = 1, y = 0, xend = 0, yend = 0, linetype = "dashed") +
geom_ribbon(aes(ymin = ci.lb, ymax = ci.ub), alpha = .2) +
scale_y_continuous(trans = "log", breaks = c(.8, .85, .9, .95, 1, 1.05, 1.1)) +
labs(x = "Exposure", y = "Relative Risk") +
theme_classic()
data.frame(dose = c(2, seq(0, 8, length.out = 100))) %>%
cbind(
predict(spl, ., expo = T)
) %>%
ggplot(aes(dose, pred)) +
geom_line() +
geom_segment(x = 1, y = -1, xend = 1, yend = 0, linetype = "dashed") +
geom_segment(x = 1, y = 0, xend = 0, yend = 0, linetype = "dashed") +
geom_ribbon(aes(ymin = ci.lb, ymax = ci.ub), alpha = .2) +
scale_y_continuous(trans = "log", breaks = c(.8, .85, .9, .95, 1, 1.05, 1.1)) +
labs(x = "Exposure", y = "Relative Risk") +
theme_classic()
data.frame(dose = c(2, seq(0, 8, length.out = 100))) %>%
cbind(
predict(spl, ., expo = T)
) %>%
ggplot(aes(dose, pred)) +
geom_line() +
geom_segment(x = 2, y = -1, xend = 2, yend = 0, linetype = "dashed") +
geom_segment(x = 2, y = 0, xend = 0, yend = 0, linetype = "dashed") +
geom_ribbon(aes(ymin = ci.lb, ymax = ci.ub), alpha = .2) +
scale_y_continuous(trans = "log", breaks = c(.8, .85, .9, .95, 1, 1.05, 1.1)) +
labs(x = "Exposure", y = "Relative Risk") +
theme_classic()
data.frame(dose = c(2, seq(0, 8, length.out = 100))) %>%
cbind(
predict(spl, ., expo = T)
) %>%
ggplot(aes(dose, pred)) +
geom_line() +
geom_segment(x = 2, y = -1, xend = 2, yend = 0, linetype = "dashed") +
geom_segment(x = 2, y = 0, xend = 0, yend = 0, linetype = "dashed") +
geom_ribbon(aes(ymin = ci.lb, ymax = ci.ub), alpha = .2) +
scale_y_continuous(trans = "log", breaks = c(.8, .85, .9, .95, 1, 1.05, 1.1, 1.2)) +
labs(x = "Exposure", y = "Relative Risk") +
theme_classic()
data.frame(dose = c(2, seq(0, 8, length.out = 100))) %>%
cbind(
predict(spl, ., expo = T)
) %>%
ggplot(aes(dose, pred)) +
geom_line() +
geom_segment(x = 2, y = -1, xend = 2, yend = 0, linetype = "dashed") +
geom_segment(x = 2, y = 0, xend = 0, yend = 0, linetype = "dashed") +
geom_ribbon(aes(ymin = ci.lb, ymax = ci.ub), alpha = .2) +
scale_y_continuous(trans = "log", breaks = c(.95, 1, 1.05, 1.1, 1.15, 1.2)) +
labs(x = "Exposure", y = "Relative Risk") +
theme_classic()
library(metafor)
library(tidyverse)
library(dosresmeta)
library(rms)
library(hetmeta)
?get
dat <- get(coffee_mort, asNamespace(dosresmeta))
dat <- get(coffee_mort, asNamespace("dosresmeta"))
?rma.uni
